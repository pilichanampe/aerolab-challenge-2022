import Head from 'next/head';
import { useContext, useEffect, useState } from 'react';
import styled from 'styled-components';
import AeropayDropdown from '../components/AeropayDropdown';
import { Box } from '../components/basecomponents/Box';
import { getProducts } from '../components/common/getProducts';
import ProductsList from '../components/ProductsList';
import { getUser } from '../components/common/getUser';
import { useUserContext } from '../context/UserContext';
import { useProductsContext } from '../context/ProductsContext';

export const getStaticProps = async () => {
  const user = await getUser();
  const productsSSR = await getProducts();
  
  return {
    props: {
      productsSSR,
      user,
    }
  }
}

const Main = styled(Box)`
  width: 100%;
`;
export default function Home({ user, productsSSR }) {
  const [prueba, setPrueba] = useState(productsSSR);
  const { points, setPoints, products, setProducts, setName } = useUserContext();
  
  useEffect(() => {
    setPoints(user.points);
    setName(user.name);
    setProducts(prueba);    

  }, []);
  
  return (
    <div >
      <Head>
        <title>Tech Zone</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.svg" />
      </Head>
      <Main as="main">
        <Box
          maxWidth={1464}
        >
          <section>
            <Box
              as="header"
              display="flex"
              justifyContent="end"
            >
              <AeropayDropdown points={points}></AeropayDropdown>   
            </Box>
            <ProductsList></ProductsList>
          </section>
        </Box>
       </Main>

    </div>
  )
}
