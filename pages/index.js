import Head from 'next/head';
import { useEffect } from 'react';
import styled from 'styled-components';
import { Box } from '../components/basecomponents/Box';
import { getProducts } from '../components/common/getProducts';
import ProductsList from '../components/ProductsList';
import { getUser } from '../components/common/getUser';
import { useUserContext } from '../context/UserContext';
import { useProductsContext } from '../context/ProductsContext';
import Footer from '../components/Footer';
import Navbar from '../components/Navbar';
import Header from '../components/Header';

export const getStaticProps = async () => {
  const user = await getUser();
  const products = await getProducts();
  const productsSSR = products;
  const categories = productsSSR.map(product => product.category);
  const categoriesSSR = [... new Set(categories)];
 
  return {
    props: {
      productsSSR,
      categoriesSSR,
      user,
    }
  }
}

const Grid = styled(Box)`
  @media only screen and (min-width: 1464px) {
    margin: 0px 80px;
  }

  @media only screen and ( max-width: 1463px) {
    margin: 0px 20px;
  }
`;

const Main = styled(Box)`
  width: 100%;
  position: relative;
`;

const WavesPattern = styled(Box)`
  display: flex;
  background-image: url('./illustrations/figma-pattern.svg');
  position: absolute;
  height: 900px;
  width: 100%;
  z-index: -1;
  display: flex;
  top: 230px;
  justify-content: center;
`;

export default function Home({ user, productsSSR, categoriesSSR }) {
  const { setPoints, setName } = useUserContext();
  const { setCategories, products, setProducts, setAllProducts } = useProductsContext();
  useEffect(() => {
    setPoints(user.points);
    setProducts(productsSSR);
    setName(user.name);
    setCategories(categoriesSSR);
    setAllProducts(productsSSR);

  }, []);
  
  return (
    <div >
      <Head>
        <title>Tech Zone</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.svg" />
      </Head>
      <Main
        as="main"
      >
        <WavesPattern>
        </WavesPattern>
        <Navbar>
        </Navbar>
        <Grid
          maxWidth="1464px"
        >
          <Header></Header>
          <Box
            as="section"
            mt="128px"
          >
            <Box
              as="header"
              display="flex"
              justifyContent="end"
            >
            </Box>
            {products && <ProductsList></ProductsList>}
          </Box>
          <Footer></Footer>
        </Grid>
       </Main>
    </div>
  )
}
